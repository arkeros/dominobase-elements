<link href='../polymer/polymer.html' rel='import'>
<link href='pages.html' rel='import'>
<link href='../app-router/app-router.html' rel='import'>
<link href='../pushstate-anchor/pushstate-anchor.html' rel='import'>
<!-- %link(href="strophe.html" rel="import") -->
<polymer-element attributes='user' constructor='DominobaseApp' name='dominobase-app' on-google-signin-success='{{SignInGoogle}}'>
  <template>
    <app-router>
      <app-route element='home-page' path='/build/'></app-route>
      <app-route element='home-page' path='/dominobase/'></app-route>
      <app-route element='home-page' path='/'></app-route>
      <app-route element='about-page' path='/about'></app-route>
      <app-route element='team-page' path='/team'></app-route>
      <app-route element='press-page' path='/press'></app-route>
      <app-route element='jobs-page' path='/jobs'></app-route>
      <app-route element='contact-page' path='/contact'></app-route>
      <app-route element='games-page' path='/games'></app-route>
      <app-route element='livegame-page' path='/games/:id'></app-route>
      <!-- %app-route(path="/players" element="players-page") -->
      <app-route element='player-page' path='/players/:slug'></app-route>
      <app-route element='not-found-page' path='*'></app-route>
    </app-router>
  </template>
  <script>(function(scope) {
  'use strict';
  return scope.Polymer('dominobase-app', {
    toggleCreateGame: function(event, detail, sender) {
      return this.$.game_create.toggle();
    },
    SignInGoogle: function(event, detail, sender) {
      var gapi, self;
      self = this;
      gapi = detail.gapi;
      scope.console.log(event);
      scope.console.log(detail);
      scope.console.log(sender);
      return gapi.client.load('plus', 'v1', function() {
        return gapi.client.plus.people.get({
          userId: 'me'
        }).execute(function(resp) {
          var xmpp;
          scope.console.log(resp);
          self.user = {
            name: resp.displayName,
            image: resp.image.url,
            email: resp.emails[0].value,
            url: resp.url,
            language: resp.language,
            gender: resp.gender,
            oauth: {
              token: detail.result.access_token
            },
            logged: true
          };
          scope.console.log(self.user);
          scope.Strophe.SASLPlain.priority = 100;
          scope.console.log(scope.Strophe);
          xmpp = scope.Strophe.Connection('ws://echo.websocket.org', {
            protocol: "ws"
          });
          xmpp.connect(self.user.email, self.user.oauth.token);
          return scope.console.log(xmpp);
        });
      });
    }
  });
})(window);
</script>
</polymer-element>
